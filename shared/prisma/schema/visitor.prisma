model VisitorData {
  singpassData Json?
  referer      String?

  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@schema("public")
}

// Enhanced visitor tracking system for multi-step loan applications
model VisitorDataV2 {
  id     String  @id @default(uuid())
  userId String? // Optional - for logged in users
  user   User?   @relation(fields: [userId], references: [id])

  // Application metadata
  loanRequestType String
  currentStep     String? // Track current step
  referer         String?
  isCompleted     Boolean @default(false)

  // Application data
  stepData     StepData[]
  singpassData Json?

  lastActiveAt DateTime @updatedAt

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@schema("public")
}

// Enhanced step data tracking with validation status
model StepData {
  id          String        @id @default(uuid())
  visitorId   String
  visitor     VisitorDataV2 @relation(fields: [visitorId], references: [id])
  stepKey     String // Matches step key from applicationSteps
  data        Json // Validated step data
  isValid     Boolean       @default(true)
  validatedAt DateTime      @default(now())
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@unique([visitorId, stepKey])
  @@schema("public")
}
