model WaUser {
    waName String?

    phone String @unique

    userId String? @unique
    user   User?   @relation(fields: [userId], references: [id])

    sentMessages     WaMessage[] @relation(name: "sent")
    receivedMessages WaMessage[] @relation(name: "received")
    groups           WaGroup[]

    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([phone])
    @@schema("public")
}

model WaMessage {
    waId     String  @unique
    text     String
    imageUrl String?

    repliedId String?

    isRead Boolean @default(false)

    sourceWaPhone String
    sourceWaUser  WaUser @relation(fields: [sourceWaPhone], references: [phone], name: "sent")

    targetWaPhone String?
    targetWaUser  WaUser? @relation(fields: [targetWaPhone], references: [phone], name: "received")

    targetGroupId String?
    targetGroup   WaGroup? @relation(fields: [targetGroupId], references: [waId])

    deliveryStatus String @default("PENDING")

    //Is sent by the platform?
    isAuto Boolean @default(false)

    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    createdById String?
    createdBy   User?   @relation(fields: [createdById], references: [id])

    @@index([waId])
    @@schema("public")
}

model WaGroup {
    waId     String  @unique
    name     String?
    isActive Boolean @default(true)

    members  WaUser[]
    messages WaMessage[]

    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([waId])
    @@schema("public")
}
